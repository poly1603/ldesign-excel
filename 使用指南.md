# ðŸ“– Excel Viewer v2.0 - ä½¿ç”¨æŒ‡å—

## å¿«é€Ÿå¼€å§‹

### å®‰è£…

```bash
npm install @ldesign/excel-viewer-core
```

### åŸºç¡€ä½¿ç”¨

```typescript
import { ExcelViewer } from '@ldesign/excel-viewer-core';

const viewer = new ExcelViewer({
  container: '#app',
  showToolbar: true,
  allowEdit: true,
  lang: 'zh-CN',
});

await viewer.loadFile(file);
```

## æ ¸å¿ƒåŠŸèƒ½

### 1. å…¬å¼è®¡ç®—

æ”¯æŒ 100+ Excel å‡½æ•°

```typescript
import { FormulaEngine } from '@ldesign/excel-viewer-core';

const engine = new FormulaEngine();

// è®¾ç½®å•å…ƒæ ¼å€¼
engine.setCellValue('A1', 10);
engine.setCellValue('A2', 20);

// è®¡ç®—å…¬å¼
const result = engine.calculate('=SUM(A1:A2)');
console.log(result.value); // 30
```

**æ”¯æŒçš„å‡½æ•°åˆ†ç±»**:
- æ•°å­¦: SUM, AVERAGE, MAX, MIN, ROUND, POWER...
- é€»è¾‘: IF, AND, OR, NOT, IFERROR...
- æ–‡æœ¬: CONCATENATE, LEFT, RIGHT, UPPER, LOWER...
- æ—¥æœŸ: TODAY, NOW, DATE, YEAR, MONTH...
- æŸ¥æ‰¾: VLOOKUP, HLOOKUP, INDEX, MATCH...

### 2. æ•°æ®éªŒè¯

```typescript
import { DataValidator, ValidationType, ValidationOperator } from '@ldesign/excel-viewer-core';

const validator = new DataValidator();

// æ•´æ•°èŒƒå›´éªŒè¯
validator.addRule('A1', {
  type: ValidationType.WHOLE_NUMBER,
  operator: ValidationOperator.BETWEEN,
  formula1: '1',
  formula2: '100',
  errorMessage: 'è¯·è¾“å…¥ 1-100 ä¹‹é—´çš„æ•´æ•°',
});

// ä¸‹æ‹‰åˆ—è¡¨
validator.addRule('B1', {
  type: ValidationType.LIST,
  list: ['é€‰é¡¹1', 'é€‰é¡¹2', 'é€‰é¡¹3'],
  showDropdown: true,
});

// éªŒè¯
const result = validator.validate('A1', 50);
if (!result.valid) {
  console.error(result.error);
}
```

### 3. æŸ¥æ‰¾æ›¿æ¢

```typescript
import { FindReplaceManager } from '@ldesign/excel-viewer-core';

const manager = new FindReplaceManager();

// æŸ¥æ‰¾
const results = manager.find(data, {
  keyword: 'hello',
  caseSensitive: false,
  useRegex: false,
});

// æ›¿æ¢
manager.replace(data, {
  keyword: 'hello',
  replaceText: 'world',
  replaceAll: true,
});
```

### 4. é«˜çº§ç­›é€‰

```typescript
import { FilterSortManager, FilterType, LogicalOperator } from '@ldesign/excel-viewer-core';

const manager = new FilterSortManager();

// ç­›é€‰
const result = manager.filterAndSort(data, {
  operator: LogicalOperator.AND,
  conditions: [
    { column: 0, type: FilterType.GREATER_THAN, value1: 100 },
    { column: 1, type: FilterType.CONTAINS, value1: 'åŒ—äº¬' },
  ],
});
```

### 5. æ¡ä»¶æ ¼å¼

```typescript
import { ConditionalFormatManager, ConditionalFormatType } from '@ldesign/excel-viewer-core';

const manager = new ConditionalFormatManager();

// æ•°æ®æ¡
manager.addRule({
  id: 'rule1',
  type: ConditionalFormatType.DATA_BAR,
  range: { startRow: 1, startCol: 0, endRow: 100, endCol: 0 },
  dataBar: {
    color: '#4472C4',
    showValue: true,
  },
});

// åº”ç”¨
const results = manager.apply(data);
```

### 6. å¿«æ·é”®

```typescript
import { KeyboardManager } from '@ldesign/excel-viewer-core';

const keyboard = new KeyboardManager();

// è‡ªå®šä¹‰å¿«æ·é”®
keyboard.register({
  key: 's',
  modifiers: { ctrl: true },
  handler: () => {
    console.log('ä¿å­˜');
    return false; // é˜»æ­¢é»˜è®¤è¡Œä¸º
  },
  description: 'ä¿å­˜',
});

keyboard.startListening();
```

### 7. å›½é™…åŒ–

```typescript
import { getI18n } from '@ldesign/excel-viewer-core';

const i18n = getI18n();

// åˆ‡æ¢è¯­è¨€
i18n.setLocale('en-US');

// ç¿»è¯‘
const text = i18n.t('common.save');

// æ ¼å¼åŒ–
const date = i18n.formatDate(new Date());
const number = i18n.formatNumber(1234.56);
const currency = i18n.formatCurrency(99.99);
```

## æ€§èƒ½ä¼˜åŒ–

### Web Worker åŽå°è§£æž

```typescript
const viewer = new ExcelViewer({
  container: '#app',
  performance: {
    useWebWorker: true,  // å¯ç”¨ Worker
    chunkSize: 10000,    // åˆ†å—å¤§å°
    lazyLoad: true,      // æ‡’åŠ è½½
  },
});
```

### å†…å­˜ç®¡ç†

```typescript
import { LRUCache, MemoryMonitor } from '@ldesign/excel-viewer-core';

// LRU ç¼“å­˜
const cache = new LRUCache(100);
cache.set('key', value);
const stats = cache.getStats();

// å†…å­˜ç›‘æŽ§
const monitor = new MemoryMonitor();
monitor.onMemoryChange((info) => {
  console.log(`å†…å­˜ä½¿ç”¨: ${info.usageRatio * 100}%`);
});
monitor.start();
```

## å¯¼å‡ºåŠŸèƒ½

```typescript
// å¯¼å‡ºä¸º Excel
viewer.downloadFile({
  format: 'xlsx',
  filename: 'export.xlsx',
  includeStyles: true,
  includeFormulas: true,
});

// å¯¼å‡ºä¸º CSV
viewer.downloadFile({
  format: 'csv',
  filename: 'export.csv',
});

// å¯¼å‡ºæˆªå›¾
await viewer.downloadScreenshot('screenshot.png');
```

## äº‹ä»¶ç›‘å¬

```typescript
viewer.on('load', (data) => {
  console.log('æ–‡ä»¶åŠ è½½å®Œæˆ', data);
});

viewer.on('cellChange', (data) => {
  console.log('å•å…ƒæ ¼å˜åŒ–', data);
});

viewer.on('error', (data) => {
  console.error('é”™è¯¯', data);
});
```

## å®Œæ•´ç¤ºä¾‹

```typescript
import {
  ExcelViewer,
  FormulaEngine,
  DataValidator,
  FindReplaceManager,
  FilterSortManager,
  ConditionalFormatManager,
  getI18n,
} from '@ldesign/excel-viewer-core';

// åˆ›å»ºæŸ¥çœ‹å™¨
const viewer = new ExcelViewer({
  container: '#app',
  showToolbar: true,
  allowEdit: true,
  lang: 'zh-CN',
  performance: {
    useWebWorker: true,
    chunkSize: 10000,
    lazyLoad: true,
  },
});

// åŠ è½½æ–‡ä»¶
await viewer.loadFile(file);

// å…¬å¼è®¡ç®—
const engine = new FormulaEngine();
engine.setCellValue('A1', 100);
const result = engine.calculate('=A1*2');

// æ•°æ®éªŒè¯
const validator = new DataValidator();
validator.addRule('A1', {
  type: 'whole_number',
  operator: 'between',
  formula1: '1',
  formula2: '100',
});

// æŸ¥æ‰¾æ›¿æ¢
const findReplace = new FindReplaceManager();
const results = findReplace.find(data, {
  keyword: 'test',
  caseSensitive: false,
});

// ç­›é€‰æŽ’åº
const filterSort = new FilterSortManager();
const filtered = filterSort.filterAndSort(data, filterGroup, sortRules);

// æ¡ä»¶æ ¼å¼
const conditionalFormat = new ConditionalFormatManager();
conditionalFormat.addRule(rule);
const formatted = conditionalFormat.apply(data);

// å›½é™…åŒ–
const i18n = getI18n();
i18n.setLocale('zh-CN');
const text = i18n.t('common.save');
```

## æ›´å¤šèµ„æº

- ðŸ“š [API å‚è€ƒæ–‡æ¡£](./API_REFERENCE.md)
- ðŸš€ [ä¼˜åŒ–æ€»ç»“](./OPTIMIZATION_SUMMARY.md)
- ðŸ“– [å®Œæ•´ README](./README_V2.md)
- âœ… [äº¤ä»˜æ¸…å•](./DELIVERY_CHECKLIST.md)

## å¸¸è§é—®é¢˜

### 1. å¦‚ä½•å¤„ç†å¤§æ–‡ä»¶?

å¯ç”¨ Web Worker å’Œæ‡’åŠ è½½:

```typescript
const viewer = new ExcelViewer({
  performance: {
    useWebWorker: true,
    lazyLoad: true,
  },
});
```

### 2. å¦‚ä½•è‡ªå®šä¹‰å¿«æ·é”®?

```typescript
const keyboard = getKeyboardManager();
keyboard.register({
  key: 's',
  modifiers: { ctrl: true, shift: true },
  handler: () => { /* è‡ªå®šä¹‰æ“ä½œ */ },
});
```

### 3. å¦‚ä½•æ·»åŠ è‡ªå®šä¹‰å‡½æ•°?

```typescript
const engine = new FormulaEngine();
engine.registerFunction('CUSTOM', (x) => x * 2);
```

---

**ç‰ˆæœ¬**: v2.0.0
**æ›´æ–°æ—¶é—´**: 2024-10-22


